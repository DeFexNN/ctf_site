---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import CTFCard from '../components/CTFCard.astro';

import { getCollection } from 'astro:content';

// Fetch content
const allCtfs = (await getCollection('ctfs'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());



const latestCtfs = allCtfs.slice(0, 6);
// Helper to create slug from event name
function slugify(str: string): string {
  return str
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)/g, '');
}
---

<BaseLayout title="Home">
  <!-- Hero -->
  <Hero
    name="DeFexGG"
    subtitle="CTF Player & Security Researcher // Breaking things to learn how they work."
  />

  <!-- Latest CTF Writeups Section -->
  <section class="max-w-6xl w-full mx-auto px-4 md:px-10 mt-16 mb-12 text-center" style="max-width: 72rem; margin-left: auto; margin-right: auto; width: 100%;">
    <h2 class="font-mono text-xl font-bold text-neon-green mb-2">
      <span class="text-text-muted">//</span> Latest Writeups
    </h2>
    <a href={`${import.meta.env.BASE_URL}ctfs`} class="font-mono text-xs text-text-muted hover:text-neon-green transition-colors inline-block mb-8">
      view all &gt;
    </a>

    {latestCtfs.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-left">
        {latestCtfs.map((post) => (
          <CTFCard
            title={post.data.title}
            date={post.data.date}
            category={post.data.category}
            ctfEvent={post.data.ctf_event}
            tags={post.data.tags}
            points={post.data.points}
            isSolved={post.data.is_solved}
            slug={post.id}
            eventSlug={slugify(post.data.ctf_event)}
          />
        ))}
      </div>
    ) : (
      <div class="glass rounded-xl p-8 text-center border border-glass-border">
        <p class="font-mono text-sm text-text-muted">
          <span class="text-neon-green">$</span> No writeups yet. Start hacking!
        </p>
      </div>
    )}
  </section>


</BaseLayout>
