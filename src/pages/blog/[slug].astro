---
import BaseLayout from '../../layouts/BaseLayout.astro';
import TableOfContents from '../../components/TableOfContents.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content, headings } = await render(post);
const formattedDate = post.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <article class="max-w-6xl w-full mx-auto px-4 md:px-10 py-12" style="max-width: 72rem; margin-left: auto; margin-right: auto; width: 100%;">
    <div class="flex flex-col lg:flex-row gap-10">
      <!-- Main Content -->
      <div class="flex-1 min-w-0">
        <!-- Breadcrumb -->
        <nav class="font-mono text-xs text-text-muted mb-6 reveal">
          <a href={`${import.meta.env.BASE_URL}`} class="hover:text-neon-green transition-colors">~</a>
          <span class="mx-1">/</span>
          <a href={`${import.meta.env.BASE_URL}blog`} class="hover:text-neon-purple transition-colors">blog</a>
          <span class="mx-1">/</span>
          <span class="text-neon-purple">{post.id}</span>
        </nav>

        <!-- Header -->
        <header class="mb-10 reveal">
          <h1 class="font-mono text-3xl md:text-4xl font-bold text-white mb-4">
            {post.data.title}
          </h1>
          <div class="flex items-center gap-4 font-mono text-xs text-text-muted">
            <time>{formattedDate}</time>
          </div>
          {post.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-1.5 mt-4">
              {post.data.tags.map((tag) => (
                <span class="font-mono text-[10px] rounded bg-surface-light text-text-muted border border-glass-border" style="padding: 0.25rem 0.6rem;">
                  #{tag}
                </span>
              ))}
            </div>
          )}
        </header>

        <!-- Article Body -->
        <div class="prose max-w-none">
          <Content />
        </div>
      </div>

      <!-- Sidebar: Table of Contents -->
      <aside class="hidden lg:block w-64 shrink-0">
        <TableOfContents headings={headings} />
      </aside>
    </div>
  </article>
</BaseLayout>
